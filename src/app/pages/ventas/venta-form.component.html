<button class="btn icon" (click)="open.set(true)" [disabled]="data.mode() === 'csv'" aria-label="Nueva venta">
  <span class="btn-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 11V6h2v5h5v2h-5v5h-2v-5H6v-2h5z"/></svg></span>
  <span class="btn-label">Nueva venta</span>
  </button>

<div *ngIf="open()" class="card" style="margin-top:12px;">
  <form #ventaForm="ngForm" (ngSubmit)="submit()" novalidate>
    <div class="form-grid" style="align-items:flex-end;">
      <label>
        Fecha
        <input type="date" [(ngModel)]="model.fecha" name="fecha" required />
        <div *ngIf="ventaForm.submitted && !model.fecha" style="color:#c0392b; font-size:12px;">Campo requerido</div>
      </label>
      <label>
        Medio de pago
        <select [(ngModel)]="model.medioPago" name="medioPago" required>
          <option value="Efectivo">Efectivo</option>
          <option value="Tarjeta">Tarjeta</option>
          <option value="Transferencia">Transferencia</option>
          <option value="Otro">Otro</option>
        </select>
      </label>
      <label>
        Estado del pago
        <select [(ngModel)]="model.estadoPago" name="estadoPago" required>
          <option value="Pagado">Pagado</option>
          <option value="Pendiente">Pendiente</option>
          <option value="Parcial">Parcial</option>
        </select>
      </label>
      <label>Cliente 
        <input type="text" [(ngModel)]="model.cliente" name="cliente" list="clientes-list" (input)="onClienteChange($event.target.value)" required />
        <datalist id="clientes-list">
          <option *ngFor="let c of data.clientes()" [value]="c.nombre"></option>
        </datalist>
        <div *ngIf="ventaForm.submitted && !model.cliente?.trim()" style="color:#c0392b; font-size:12px;">Campo requerido</div>
      </label>
      <label>Producto 
        <input type="text" [(ngModel)]="model.producto" name="producto" list="productos-list" (input)="onProductoChange($event.target.value)" required />
        <datalist id="productos-list">
          <option *ngFor="let p of data.productos()" [value]="p.nombre"></option>
        </datalist>
        <div *ngIf="ventaForm.submitted && !model.producto?.trim()" style="color:#c0392b; font-size:12px;">Campo requerido</div>
      </label>
      <label>
        Cantidad
        <input type="number" [(ngModel)]="model.cantidad" name="cantidad" min="1" required />
        <div *ngIf="ventaForm.submitted && (!(model.cantidad >= 1))" style="color:#c0392b; font-size:12px;">Debe ser mayor o igual a 1</div>
      </label>
      <label>
        Precio
        <input type="number" [(ngModel)]="model.precio" name="precio" min="0" step="0.01" required />
        <div *ngIf="ventaForm.submitted && (model.precio === null || model.precio === undefined || model.precio < 0)" style="color:#c0392b; font-size:12px;">Debe ser mayor o igual a 0</div>
      </label>
      <div class="total-field">
        <div>Total</div>
        <div class="value">{{ total() | currency:'USD':'symbol':'1.2-2' }}</div>
      </div>
    </div>
    <div class="form-actions actions">
      <button class="btn icon" type="submit" [disabled]="ventaForm.invalid || data.mode() === 'csv'" aria-label="Guardar">
        <span class="btn-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H5a2 2 0 00-2 2v14h18V7l-4-4zM6 5h8v4H6V5zm6 14a3 3 0 110-6 3 3 0 010 6z"/></svg></span>
        <span class="btn-label">Guardar</span>
      </button>
      <button class="btn secondary icon" type="button" (click)="open.set(false)" aria-label="Cancelar">
        <span class="btn-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 6l12 12M6 18L18 6"/></svg></span>
        <span class="btn-label">Cancelar</span>
      </button>
    </div>
  </form>
  
  <div style="color:var(--muted); margin-top:8px;" *ngIf="data.mode() === 'csv'">
    Modo CSV: solo lectura (deshabilitado crear/editar/eliminar)
  </div>
  <div style="color:var(--muted); margin-top:8px;" *ngIf="data.mode() === 'api'">
    Usando API de Google Apps Script
  </div>
  <div style="color:var(--muted); margin-top:8px;" *ngIf="data.mode() === 'mock'">
    Usando datos locales de ejemplo
  </div>
</div>

<div class="toast" *ngIf="toast" [ngClass]="toastKind" [class.leaving]="toastLeaving">{{ toast }}</div>
