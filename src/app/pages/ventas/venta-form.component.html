<button class="btn" (click)="open.set(true)" [disabled]="data.mode() === 'csv'">Nueva venta</button>

<div *ngIf="open()" class="card" style="margin-top:12px;">
  <form #ventaForm="ngForm" (ngSubmit)="submit()" novalidate>
    <div style="display:grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap:12px;">
      <label>
        Fecha
        <input type="date" [(ngModel)]="model.fecha" name="fecha" required />
        <div *ngIf="ventaForm.submitted && !model.fecha" style="color:#c0392b; font-size:12px;">Campo requerido</div>
      </label>
      <label>Cliente 
        <input type="text" [(ngModel)]="model.cliente" name="cliente" list="clientes-list" (input)="onClienteChange($event.target.value)" required />
        <datalist id="clientes-list">
          <option *ngFor="let c of data.clientes()" [value]="c.nombre"></option>
        </datalist>
        <div *ngIf="ventaForm.submitted && !model.cliente?.trim()" style="color:#c0392b; font-size:12px;">Campo requerido</div>
      </label>
      <label>Producto 
        <input type="text" [(ngModel)]="model.producto" name="producto" list="productos-list" (input)="onProductoChange($event.target.value)" required />
        <datalist id="productos-list">
          <option *ngFor="let p of data.productos()" [value]="p.nombre"></option>
        </datalist>
        <div *ngIf="ventaForm.submitted && !model.producto?.trim()" style="color:#c0392b; font-size:12px;">Campo requerido</div>
      </label>
      <label>
        Cantidad
        <input type="number" [(ngModel)]="model.cantidad" name="cantidad" min="1" required />
        <div *ngIf="ventaForm.submitted && (!(model.cantidad >= 1))" style="color:#c0392b; font-size:12px;">Debe ser mayor o igual a 1</div>
      </label>
      <label>
        Precio
        <input type="number" [(ngModel)]="model.precio" name="precio" min="0" step="0.01" required />
        <div *ngIf="ventaForm.submitted && (model.precio === null || model.precio === undefined || model.precio < 0)" style="color:#c0392b; font-size:12px;">Debe ser mayor o igual a 0</div>
      </label>
      <div style="display:flex; align-items:end; gap:6px; color:var(--muted);">
        <div>Total</div>
        <div style="font-weight:700; color:var(--text);">{{ total() | currency:'USD':'symbol':'1.2-2' }}</div>
      </div>
    </div>
    <div style="margin-top:12px; display:flex; gap:8px;">
      <button class="btn" type="submit" [disabled]="ventaForm.invalid || data.mode() === 'csv'">Guardar</button>
      <button class="btn secondary" type="button" (click)="open.set(false)">Cancelar</button>
    </div>
  </form>
  <div style="color:var(--muted); margin-top:8px;" *ngIf="data.mode() === 'csv'">
    Modo CSV: solo lectura (deshabilitado crear/editar/eliminar)
  </div>
  <div style="color:var(--muted); margin-top:8px;" *ngIf="data.mode() === 'api'">
    Usando API de Google Apps Script
  </div>
  <div style="color:var(--muted); margin-top:8px;" *ngIf="data.mode() === 'mock'">
    Usando datos locales de ejemplo
  </div>
  
</div>
